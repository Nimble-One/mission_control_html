<!DOCTYPE html>
<html data-bs-theme="dark" lang="en">

<head>
    <title>Mission Control UI</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- 3RD PARTY -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script src="js/bootstrap.bundle.min.js"></script>

    <script src="../../os/web/utils/index.js"></script>
    <script src="js/battery.js"></script>
    <script src="js/gamepad.js"></script>
    <script src="js/streaming.js"></script>
</head>

<body>
    <!-- HEADER -->
    <header id="cnt-header">
        <div id="cnt-header-logo">
            <svg class="header-logo">
                <use xlink:href="#logo" />
            </svg>
        </div>

        <!-- HEADER INFOS -->
        <div id="cnt-header-infos">
            <div class="status-item">
                <span class="status-title">Operating Status</span>
                <span id="div-operating-status" class="status-info">-</span>
            </div>

            <div class="status-item">
                <span class="status-title">Supervisor Status</span>
                <span id="div-supervisor-status" class="status-info">-</span>
            </div>

            <div id="cdt-header-info-substate" class="status-item">
                <span class="status-title">Control mode</span>
                <span id="div-supervisor-substatus" class="status-info">-</span>
            </div>
        </div>

        <!-- HEADER NAV -->
        <nav id="cnt-header-navbar">
            <div class="nav-item">
                <svg id="header-icon-env" class="disabled-fill" width="50" height="50">
                    <use xlink:href="#svg-icon-laptop" />
                </svg>
            </div>
            <div class="nav-item">
                <svg id="header-icon-wifi" class="disabled-fill" width="50" height="50">
                    <use xlink:href="#svg-icon-wifi" />
                </svg>
            </div>
            <div class="nav-item">
                <svg id="header-icon-gamepad" class="disabled-fill" width="50" height="50">
                    <use xlink:href="#svg-icon-gamepad" />
                </svg>
            </div>
            <div class="nav-item">
                <svg id="header-icon-camera" class="disabled-fill" width="50" height="50">
                    <use xlink:href="#svg-icon-camera" />
                </svg>
            </div>
            <div class="battery-item">
                <svg id="header-icon-robot-battery" class="disabled-fill" width="50" height="50">
                    <use xlink:href="#svg-icon-robot-battery" />
                </svg>
                <span id="header-percent-robot-battery">-</span>
            </div>
            <div class="battery-item">
                <svg id="header-icon-host-battery" class="disabled-fill" width="50" height="50">
                    <use xlink:href="#svg-icon-host-battery" />
                </svg>
                <span id="header-percent-host-battery">-</span>
            </div>
        </nav>
    </header>

    <!-- MAIN CONTENT -->
    <div id="cnt-main">
        <!-- LEFT BAR EMERGENCY -->
        <aside id="cnt-emergency" aria-label="emergency" class="left-bar">

            <div class="empty">
                >
            </div>

            <span class="title">Emergency</span>
            <button id="btn-emergency-run" class="btn btn-dark emergency-button btn-outline-warning"
                onclick="sendSafetyCommand(EOperatingStatus.RUNNING)">
                <span>RUN</span>
                <svg style="left: -74px" width="30" height="30">
                    <use xlink:href="#warning" />
                </svg>
            </button>
            <button id="btn-emergency-freeze" class="btn btn-dark emergency-button"
                onclick="sendSafetyCommand(EOperatingStatus.FROZEN)">
                <span>FREEZE</span>
                <svg style="left: -88px" width="30" height="30">
                    <use xlink:href="#weatherSnowflake" />
                </svg>
            </button>
            <button id="btn-emergency-disengage" class="btn btn-dark emergency-button"
                onclick="sendSafetyCommand(EOperatingStatus.DISENGAGING)">
                <span style="left: 2px; top: 15px">DISENGAGE</span>
                <svg style="left: -55px; top: -56px" width="30" height="30">
                    <use xlink:href="#info" />
                </svg>
            </button>
            <button id="btn-emergency-poweroff" class="btn btn-dark emergency-button btn-outline-danger"
                onclick="sendSafetyCommand(EOperatingStatus.UNPOWERED)">
                <span style="left: 2px; top: 15px">POWER OFF</span>
                <svg style="left: -55px; top: -56px" width="30" height="30">
                    <use xlink:href="#flash" />
                </svg>
            </button>
        </aside>

        <!-- MAIN VIEW -->
        <div class="view section">
            <div class="header-section">
                <svg viewBox="0 0 50 50" width="25" height="25">
                    <use xlink:href="#svg-icon-camera" />
                </svg>
                Vision Camera
            </div>

            <!-- VIEW CAMERA -->
            <div class="camera-view">
                <img id="img-camera-view" src="img/issou.jpg" />
            </div>
        </div>

        <!-- RIGHT BAR ACTIONS/DATA -->
        <aside aria-label="actions" class="right-bar">
            <div class="section">
                <div class="header-section">
                    <svg width="25" height="25">
                        <use xlink:href="#code" />
                    </svg>
                    Action
                </div>

                <!-- ACTIONS -->
                <div class="content-section">
                    <button id="bt-toggle-loop-lock" type="button" onclick="toggleLoopLock();"
                        class="btn btn-lg btn-outline-light disabled">
                        Loop Locked
                    </button>
                    <button id="bt-toggle-adjust-wheels" type="button" onclick="toggleAdjustWheels();"
                        class="btn btn-lg btn-outline-light disabled">
                        Adjust Wheels
                    </button>
                    <button id="bt-toggle-aga" type="button" onclick="toggleAGA();"
                        class="btn btn-lg btn-outline-light disabled">
                        AGA
                    </button>
                    <button id="bt-toggle-autorotate" type="button" onclick="toggleAutoRotate();"
                        class="btn btn-lg btn-outline-light btn-success">
                        Auto Rotate
                    </button>
                    <button id="bt-toggle-vision-source" type="button" onclick="toggleVisionSource();"
                        class="btn btn-lg btn-outline-light">
                        RGB Camera
                    </button>
                </div>
            </div>

            <!-- BATTERY -->
            <div class="section">
                <div class="header-section">
                    <svg id="section-icon-robot-battery" viewBox="0 0 50 50" width="25" height="25">
                        <use xlink:href="#svg-icon-robot-battery" />
                    </svg>
                    Battery Status
                </div>

                <div class="content-section">
                    <div class="even-line line-data">
                        <div id="battery-state-volt-key" class="line-label">Voltage:</div>
                        <div id="battery-state-volt-val" class="line-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div id="battery-state-current-key" class="line-label">Current:</div>
                        <div id="battery-state-current-val" class="line-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div id="battery-state-capa-key" class="line-label">Capacity:</div>
                        <div id="battery-state-capa-val" class="line-value">-</div>
                    </div>
                </div>
            </div>

            <!-- MOTOR TORQUES (BY LIMB KIND) -->
            <!--
            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25">
                        <use xlink:href="#gauge" />
                    </svg>
                    Shoulder Motors
                </div>

                <div id="div-shoulder-motors" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">C1 :</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C2 :</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">C3 :</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C4 :</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                </div>
            </div>
            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25">
                        <use xlink:href="#gauge" />
                    </svg>
                    Arm Motors
                </div>

                <div id="div-arm-motors" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">C1:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C2:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">C3:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C4:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                </div>
            </div>
            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25">
                        <use xlink:href="#gauge" />
                    </svg>
                    Forearm Motors
                </div>

                <div id="div-forearm-motors" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">C1:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C2:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">C3:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C4:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                </div>
            </div>
            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25">
                        <use xlink:href="#gauge" />
                    </svg>
                    Wheel Orientation
                </div>

                <div id="div-wheel-orientation" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">C1:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C2:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">C3:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C4:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                </div>
            </div>
            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25">
                        <use xlink:href="#gauge" />
                    </svg>
                    Wheel Rotation
                </div>

                <div id="div-wheel-rotation" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">C1:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C2:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">C3:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">C4:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                </div>
            </div>
            -->

            <!-- MOTOR TORQUES (BY COMPASS ID) -->
            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25" class="C1-fill">
                        <use xlink:href="#gauge" />
                    </svg>
                    C1
                </div>

                <div id="div-motors-c1" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">Shoulder:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Arm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">Forearm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Wheel Orientation:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <!-- <div class="even-line line-data">
                        <div class="line-label">Wheel Rotation:</div>
                        <div class="line-value danger-value">-</div>
                    </div> -->
                </div>
            </div>

            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25" class="C2-fill">
                        <use xlink:href="#gauge" />
                    </svg>
                    C2
                </div>

                <div id="div-motors-c2" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">Shoulder:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Arm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">Forearm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Wheel Orientation:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <!-- <div class="even-line line-data">
                        <div class="line-label">Wheel Rotation:</div>
                        <div class="line-value danger-value">-</div>
                    </div> -->
                </div>
            </div>

            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25" class="C3-fill">
                        <use xlink:href="#gauge" />
                    </svg>
                    C3
                </div>

                <div id="div-motors-c3" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">Shoulder:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Arm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">Forearm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Wheel Orientation:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <!-- <div class="even-line line-data">
                        <div class="line-label">Wheel Rotation:</div>
                        <div class="line-value danger-value">-</div>
                    </div> -->
                </div>
            </div>

            <div class="section">
                <div class="header-section">
                    <svg viewBox="0 0 30 30" width="25" height="25" class="C4-fill">
                        <use xlink:href="#gauge" />
                    </svg>
                    C4
                </div>

                <div id="div-motors-c4" class="content-section">
                    <div class="even-line line-data">
                        <div class="line-label">Shoulder:</div>
                        <div class="line-value success-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Arm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="even-line line-data">
                        <div class="line-label">Forearm:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <div class="odd-line line-data">
                        <div class="line-label">Wheel Orientation:</div>
                        <div class="line-value danger-value">-</div>
                    </div>
                    <!-- <div class="even-line line-data">
                        <div class="line-label">Wheel Rotation:</div>
                        <div class="line-value danger-value">-</div>
                    </div> -->
                </div>
            </div>

        </aside>
    </div>

    <!-- FOOTER -->
    <footer id="cnt-footer">

        <div class="command-input">
            <div class="shape-button">
                <div class="dpad"></div>
                <span class="button">DPad</span>
            </div>
            <div id="bt-dpad" class="command-info">Move</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="start-select"></div>
                <span class="button">Select</span>
            </div>
            <div id="bt-select" class="command-info">Menu Action</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="stick"></div>
                <span class="button">LStick</span>
            </div>
            <div id="bt-lstick" class="command-info">Move</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="trigger"></div>
                <span class="button">LT</span>
            </div>
            <div id="bt-lt" class="command-info">Aim</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="subtrigger"></div>
                <span class="button">LB</span>
            </div>
            <div id="bt-lb" class="command-info">Special 1</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="subtrigger"></div>
                <span class="button">RB</span>
            </div>
            <div id="bt-rb" class="command-info">Special 2</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="trigger"></div>
                <span class="button">RT</span>
            </div>
            <div id="bt-rt" class="command-info">Shoot</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="stick"></div>
                <span class="button">RStick</span>
            </div>
            <div id="bt-rstick" class="command-info">Camera</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="start-select"></div>
                <span class="button">Start</span>
            </div>
            <div id="bt-start" class="command-info">Pause</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="controls"></div>
                <span class="button">X</span>
            </div>
            <div id="bt-x" class="command-info">Push</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="controls"></div>
                <span class="button">Y</span>
            </div>
            <div id="bt-y" class="command-info">Pull</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="controls"></div>
                <span class="button">A</span>
            </div>
            <div id="bt-a" class="command-info">Jump</div>
        </div>

        <div class="command-input">
            <div class="shape-button">
                <div class="controls"></div>
                <span class="button">B</span>
            </div>
            <div id="bt-b" class="command-info">Grab</div>
        </div>
    </footer>

    <script>

        // ---------------------------------------------------------------------
        // CONFIG
        // ---------------------------------------------------------------------
        const REQUESTS_PER_SECOND = 30.0; // also defines the streaming frame rate
        const LOW_BATTERY_THRESHOLD = 20;
        const VERY_LOW_BATTERY_THRESHOLD = 10;


        // ---------------------------------------------------------------------
        // NETWORK CHECK
        // ---------------------------------------------------------------------
        const _wifi_svg = document.getElementById("header-icon-wifi");
        window.addEventListener('load', (e) => {
            _wifi_svg.setAttribute("class", navigator.onLine ? "success-fill" : "disabled-fill");
        });
        window.addEventListener('online', (e) => {
            _wifi_svg.setAttribute("class", "success-fill");
        });
        window.addEventListener('offline', (e) => {
            _wifi_svg.setAttribute("class", "disabled-fill");
        });
        const showDisconnectedStatus = () => {
            document.getElementById("header-icon-env").setAttribute("class", "disabled-fill");
            document.getElementById("header-icon-camera").setAttribute("class", "disabled-fill");
            document.getElementById("header-icon-robot-battery").setAttribute("class", "disabled-fill");
            document.getElementById("section-icon-robot-battery").setAttribute("class", "disabled-fill");
            document.getElementById("header-percent-robot-battery").innerText = "-";
        }


        // ---------------------------------------------------------------------
        // GAMEPAD
        // ---------------------------------------------------------------------
        const updateGamepadUI = (status) => {
            const gamepad_svg = document.getElementById("header-icon-gamepad");
            let style = "disabled-fill";
            switch (status) {
                case GamepadStatus.CONFLICT:
                    style = "danger-fill";
                    break;
                case GamepadStatus.CONNECTED:
                    style = "success-fill";
                    break;
                case GamepadStatus.DISCONNECTED:
                    break;
                case GamepadStatus.IDLE:
                    style = "info-fill";
                    break;
                case GamepadStatus.UNSUPPORTED:
                    style = "warning-fill";
                    break;
            }
            gamepad_svg.setAttribute("class", style);
        }

        let _gamepad_json = {};
        const _gamepad = new GamepadHandler((gamepad_json) => {
            _gamepad_json = gamepad_json;
        },
            updateGamepadUI,
            window);
        _gamepad.start();


        // ---------------------------------------------------------------------
        // STREAMING CAMERA
        // ---------------------------------------------------------------------
        const _camera_json = {
            "sensors": [
                "camera.color",
                "camera.depth"
            ],
            "ar": true, // auto-rotate TODO: retrieve from UI
            "q": 50
        }; // quality
        const updateStreamingUI = (status, rgb_image, depth_image) => {
            const streaming_svg = document.getElementById("header-icon-camera");
            let style = "disabled-fill";
            switch (status) {
                case StreamingStatus.ON:
                    style = "success-fill";
                    document.getElementById("img-camera-view").src = _vision_rgb ? rgb_image : depth_image;
                    break;
                case StreamingStatus.OFF:
                    break;
                case StreamingStatus.UNSUPPORTED:
                    style = "warning-fill";
                    break;
            }
            streaming_svg.setAttribute("class", style);
        }

        const _stream_handler = new StreamingHandler(updateStreamingUI);


        // ---------------------------------------------------------------------
        //  SUPERVISOR STATUS / TUTORIAL
        // ---------------------------------------------------------------------
        const ESupervisorStatus = {
            INIT: "Init",
            DRIVE: "DriveTeleop",
            WIGGLE: "WiggleTeleop",
            LIFT: "DriveTeleopLiftWheel",
            SNAKE: "SnakeTeleop",
        };

        const EControlTutoIDs = {
            DPAD: "bt-dpad",
            SELECT: "bt-select",
            LSTICK: "bt-lstick",
            LT: "bt-lt",
            LB: "bt-lb",
            RB: "bt-rb",
            RT: "bt-rt",
            RSTICK: "bt-rstick",
            START: "bt-start",
            X: "bt-x",
            Y: "bt-y",
            A: "bt-a",
            B: "bt-b",
        };

        const _supervisor_status_strings = {
            [ESupervisorStatus.INIT]: "Initializing",
            [ESupervisorStatus.DRIVE]: "Drive TeleOp",
            [ESupervisorStatus.WIGGLE]: "Wiggle TeleOp",
            [ESupervisorStatus.LIFT]: "Drive Lift Wheel",
            [ESupervisorStatus.SNAKE]: "Snake TeleOp",
            // hacky, those are sub-status
            "ackermann": "Ackermann",
            "crab": "Crab",
        };

        const _control_mapping_strings = {
            [ESupervisorStatus.INIT]: {
                [EControlTutoIDs.DPAD]: "-",
                [EControlTutoIDs.SELECT]: "-",
                [EControlTutoIDs.LSTICK]: "-",
                [EControlTutoIDs.LT]: "-",
                [EControlTutoIDs.LB]: "-",
                [EControlTutoIDs.RT]: "-",
                [EControlTutoIDs.RB]: "-",
                [EControlTutoIDs.RSTICK]: "-",
                [EControlTutoIDs.START]: "SV Mode",
                [EControlTutoIDs.X]: "-",
                [EControlTutoIDs.Y]: "-",
                [EControlTutoIDs.A]: "-",
                [EControlTutoIDs.B]: "-"
            },
            [ESupervisorStatus.DRIVE]: {
                [EControlTutoIDs.DPAD]: "-",
                [EControlTutoIDs.SELECT]: "-",
                [EControlTutoIDs.LSTICK]: "Move / Strafe",
                [EControlTutoIDs.LT]: "Unfold",
                [EControlTutoIDs.LB]: "DM Unfold",
                [EControlTutoIDs.RT]: "Fold",
                [EControlTutoIDs.RB]: "DM Fold",
                [EControlTutoIDs.RSTICK]: "Turn",
                [EControlTutoIDs.START]: "SV Mode",
                [EControlTutoIDs.X]: "-",
                [EControlTutoIDs.Y]: "-",
                [EControlTutoIDs.A]: "-",
                [EControlTutoIDs.B]: "CTL Mode"
            },
            [ESupervisorStatus.WIGGLE]: {
                [EControlTutoIDs.DPAD]: "-",
                [EControlTutoIDs.SELECT]: "-",
                [EControlTutoIDs.LSTICK]: "-",
                [EControlTutoIDs.LT]: "Unfold",
                [EControlTutoIDs.LB]: "DM Unfold",
                [EControlTutoIDs.RT]: "Fold",
                [EControlTutoIDs.RB]: "DM Fold",
                [EControlTutoIDs.RSTICK]: "-",
                [EControlTutoIDs.START]: "SV Mode",
                [EControlTutoIDs.X]: "-",
                [EControlTutoIDs.Y]: "-",
                [EControlTutoIDs.A]: "Wiggle",
                [EControlTutoIDs.B]: "Wiggle"
            },
            [ESupervisorStatus.LIFT]: {
                [EControlTutoIDs.DPAD]: "Compass",
                [EControlTutoIDs.SELECT]: "-",
                [EControlTutoIDs.LSTICK]: "Move / Strafe",
                [EControlTutoIDs.LT]: "-",
                [EControlTutoIDs.LB]: "-",
                [EControlTutoIDs.RT]: "-",
                [EControlTutoIDs.RB]: "-",
                [EControlTutoIDs.RSTICK]: "Turn",
                [EControlTutoIDs.START]: "SV Mode",
                [EControlTutoIDs.X]: "-",
                [EControlTutoIDs.Y]: "-",
                [EControlTutoIDs.A]: "-",
                [EControlTutoIDs.B]: "CTL Mode"
            },
            [ESupervisorStatus.SNAKE]: {
                [EControlTutoIDs.DPAD]: "-",
                [EControlTutoIDs.SELECT]: "-",
                [EControlTutoIDs.LSTICK]: "-",
                [EControlTutoIDs.LT]: "-",
                [EControlTutoIDs.LB]: "-",
                [EControlTutoIDs.RT]: "-",
                [EControlTutoIDs.RB]: "-",
                [EControlTutoIDs.RSTICK]: "-",
                [EControlTutoIDs.START]: "SV Mode",
                [EControlTutoIDs.X]: "Loop ULK",
                [EControlTutoIDs.Y]: "SQR Snake",
                [EControlTutoIDs.A]: "-",
                [EControlTutoIDs.B]: "Cat Step"
            }
        };

        const updateSupervisorStatus = (status, substatus) => {
            if (status !== null) {
                document.getElementById("div-supervisor-status").innerText = _supervisor_status_strings[status];
                document.getElementById("div-supervisor-substatus").innerText = substatus === null ? "-" : _supervisor_status_strings[substatus];

                // update tutorial
                for (let ctl_key in EControlTutoIDs) {
                    let div_id = EControlTutoIDs[ctl_key];
                    let text = _control_mapping_strings[status][div_id];
                    document.getElementById(div_id).innerText = text;
                }
            }
        }


        // ---------------------------------------------------------------------
        // ACTIONS
        // ---------------------------------------------------------------------

        // TODO: init button state from server data
        // TODO: crappy code, status is checked w/ classList :/
        const callWriteModel = (elem_id, key, slot) => {
            let bt = document.getElementById(elem_id);
            let val = !bt.classList.contains("btn-success");

            // disable button
            bt.classList.remove("btn-success");
            bt.classList.remove("btn-outline-light");
            bt.classList.add("btn-outline-secondary");
            bt.setAttribute("disabled", "");

            let query = {
                key: {
                    slot: slot,
                    type: "bool",
                    value: val
                }
            };

            call(
                "write/model",
                (data) => {
                    // TODO: data should give us the new status.
                    console.log(data);
                    bt.classList.remove("btn-outline-secondary");
                    bt.removeAttribute("disabled");
                    bt.classList.add(val ? "btn-success" : "btn-outline-light");
                },
                query
            );
        }

        const toggleLoopLock = () => {
            callWriteModel("bt-toggle-loop-lock",
                "control-stack-loop.locked",
                "loop.locked");
        }

        const toggleAdjustWheels = () => {
            callWriteModel("bt-toggle-adjust-wheels",
                "control-stack-robot.control.enable_adjust_wheels_from_q",
                "robot.control.enable_adjust_wheels_from_q");
        }

        const toggleAGA = () => {
            callWriteModel("bt-toggle-aga",
                "control-stack-robot.control.enable_aga",
                "robot.control.enable_aga");
        }

        const toggleAutoRotate = () => {
            // TODO: hacky duh
            let bt = document.getElementById("bt-toggle-autorotate");
            let auto_rotate = !bt.classList.contains("btn-success");
            _camera_json["ar"] = auto_rotate;
            bt.classList.remove("btn-success");
            bt.classList.remove("btn-outline-light");
            bt.classList.add(auto_rotate ? "btn-success" : "btn-outline-light");
        }

        let _vision_rgb = true;
        const toggleVisionSource = () => {
            _vision_rgb = !_vision_rgb;
            // TODO: hacky duh
            let bt = document.getElementById("bt-toggle-vision-source");
            bt.innerText = _vision_rgb ? "RGB Camera" : "Depth Camera";
            // let auto_rotate = !bt.classList.contains("btn-success");
            // _camera_json["ar"] = auto_rotate;
            // bt.classList.remove("btn-success");
            // bt.classList.remove("btn-outline-light");
            // bt.classList.add(auto_rotate ? "btn-success" : "btn-outline-light");
        }


        // ---------------------------------------------------------------------
        // GENERAL INFO
        // ---------------------------------------------------------------------
        let _env_icon = undefined;
        const processInfo = (info) => {
            if (_env_icon === undefined) {
                _env_icon = (info["environment"] === "simulation") ? "#svg-icon-laptop" : "#svg-icon-robot";
                document.getElementById("header-icon-env").children[0].setAttribute("xlink:href", _env_icon);
            }
        }


        // ---------------------------------------------------------------------
        // SAFETY
        // ---------------------------------------------------------------------
        const EOperatingStatus = {
            // must match 'enum class OperatingState' in AruHal20.class.hpp
            RUNNING: 0,
            FROZEN: 1,
            DISENGAGING: 2,
            UNPOWERED: 3,
        };
        const _operating_status_strings = {
            [EOperatingStatus.RUNNING]: "Running",
            [EOperatingStatus.FROZEN]: "Frozen",
            [EOperatingStatus.DISENGAGING]: "Disengaging",
            [EOperatingStatus.UNPOWERED]: "Unpowered",
        };
        let _current_operating_status = EOperatingStatus.RUNNING;
        const processSafety = (data) => {
            let status = data["state"];
            let success = data["success"];
            if (success != null && state !== null) {
                switch (state) {
                    case EOperatingState.RUNNING:
                        break;
                    case EOperatingState.FROZEN:
                        break;
                    case EOperatingState.DISENGAGING:
                        break;
                    case EOperatingState.UNPOWERED:
                        break;
                }
                document.getElementById("div-operating-status").innerText = _operating_status_strings[status];
            }
        };
        const sendSafetyCommand = (status) => {
            call("write/hal.safety", (data) => {
                // ignored
            },
                {
                    old_operating_state_id: _current_operating_status,
                    new_operating_state_id: status,
                });
        }

        // ---------------------------------------------------------------------
        // SPECIFIC EVENT PROCESSORS
        // ---------------------------------------------------------------------
        const process_wheels = (data) => {
        };

        const process_velocity_command = (data) => {
        };

        const process_log = (data) => {
        };

        const process_move_base_status = (data) => {
        };


        // ---------------------------------------------------------------------
        // BATTERIES
        // ---------------------------------------------------------------------
        const updateBatteryUI = (element, level, status) => {
            let style = "disabled-fill";
            switch (status) {
                case BatteryStatus.UNSUPPORTED:
                    style = "disabled-fill";
                    break;
                case BatteryStatus.OK:
                    style = "success-fill";
                    break;
                case BatteryStatus.LOW:
                    style = "warning-fill";
                    break;
                case BatteryStatus.VERY_LOW:
                    style = "danger-fill";
                    break;
                case BatteryStatus.CHARGING:
                    style = "info-fill";
                    break;
            }
            element.setAttribute("class", style);
        }

        const _battery_handler = new HostBatteryHandler((level, status, LOW_BATTERY_THRESHOLD, VERY_LOW_BATTERY_THRESHOLD) => {
            updateBatteryUI(document.getElementById("header-icon-host-battery"), level, status);
        });

        const processRobotBatteries = (batteries) => {
            // build final values
            let voltage = 0;
            let current = 0;
            let capacity = 0;
            let percent = 0;
            let is_supplying = false;
            for (let i = 0; i < batteries.length; ++i) {
                voltage += batteries[i][0];
                current += batteries[i][1];
                capacity += batteries[i][2];
                is_supplying |= (current < 0);
                // ignore estimated capacity
            }

            voltage /= batteries.length;
            percent = capacity / 8; // TODO: hacky, ask server
            document.getElementById("battery-state-volt-val").innerText = `${voltage.toFixed(2)} V`;
            document.getElementById("battery-state-current-val").innerText = `${current.toFixed(2)} A`;
            document.getElementById("battery-state-capa-val").innerText = `${capacity.toFixed(2)} Ah`;

            const status = is_supplying ? BatteryStatus.CHARGING :
                (percent < VERY_LOW_BATTERY_THRESHOLD ? BatteryStatus.VERY_LOW :
                    (percent < LOW_BATTERY_THRESHOLD ? BatteryStatus.LOW : BatteryStatus.OK));
            updateBatteryUI("header-icon-robot-battery", status, percent);
            updateBatteryUI("section-icon-robot-battery", status, percent);
        };


        // ---------------------------------------------------------------------
        // MOTOR TORQUES
        // ---------------------------------------------------------------------
        const _MOTOR_TORQUE_LIMITS = [
            [9.0, 36.0, 36.0, 3.0, 3.0],
            [9.0, 36.0, 36.0, 3.0, 3.0],
            [9.0, 54.0, 54.0, 3.0, 3.0],
            [9.0, 36.0, 36.0, 3.0, 3.0],
        ];

        const processMotorTorquesByLimb = (torques_array) => {
            const sections_ids = ["div-shoulder-motors",
                "div-arm-motors",
                "div-forearm-motors",
                "div-wheel-orientation",
                "div-wheel-rotation"];
            let section_count = sections_ids.length;
            let element_idx = 0;
            for (const section_id of sections_ids) {
                let section = document.getElementById(section_id);
                let compass_idx = 0;
                for (const child of section.children) {
                    let val = torques_array[element_idx + (section_count * compass_idx)];
                    let lim = _MOTOR_TORQUE_LIMITS[compass_idx][element_idx];
                    let div = child.children[1];
                    div.innerText = `${val.toFixed(2)}`;

                    // TODO: be more subtle w/ colors
                    div.className = "";
                    div.classList.add("line-value");
                    div.classList.add(val < lim ? "success-value" : "danger-value");
                    compass_idx++;
                }
                element_idx++;
            }
        };

        const processMotorTorquesByCompass = (torques_array) => {
            const compass_ids = ["div-motors-c1",
                "div-motors-c2",
                "div-motors-c3",
                "div-motors-c4"];
            let section_count = compass_ids.length;
            let compass_idx = 0;
            for (const compass_id of compass_ids) {
                let compass = document.getElementById(compass_id);

                let element_idx = 0;
                for (const child of compass.children) {
                    let val = torques_array[(element_idx * section_count) + compass_idx];
                    let lim = _MOTOR_TORQUE_LIMITS[compass_idx][element_idx];
                    let div = child.children[1];
                    div.innerText = `${val.toFixed(2)}`;

                    // TODO: be more subtle w/ colors
                    div.className = "";
                    div.classList.add("line-value");
                    div.classList.add(val < lim ? "success-value" : "danger-value");
                    element_idx++;
                }
                compass_idx++;
            }
        };



        // ---------------------------------------------------------------------
        // MAIN LOOP
        // ---------------------------------------------------------------------

        let _last_update = Date.now();
        let _poll_period_ms = 1000 / REQUESTS_PER_SECOND;
        const _MAX_POLL_PERIOD_MS = 50;
        const _MIN_POLL_PERIOD_MS = _poll_period_ms;
        // const _connected_status = document.getElementById("connected-status");
        const host_svg = document.getElementById("header-icon-env");
        const poll_server = (args) => {
            query = args;
            try {
                let request_time = Date.now();
                call(
                    "read",
                    (data) => {
                        if (data === null || data.running !== true) {
                            // _connected_status.className = "connected-status-disconnected";
                            showDisconnectedStatus();
                        } else {
                            // _connected_status.className = "connected-status-connected";
                            host_svg.setAttribute("class", "success-fill");

                            // automatically set polling period for a good user experience
                            const round_trip_time = Date.now() - request_time;
                            const current_poll_period_ms = round_trip_time * 2;
                            const alpha = 0.1;  // for exponential decay filter
                            _poll_period_ms = current_poll_period_ms * alpha + _poll_period_ms * (1.0 - alpha);
                            _poll_period_ms = Math.round(_poll_period_ms, 1);
                            _poll_period_ms = Math.min(_MAX_POLL_PERIOD_MS, _poll_period_ms);
                            _poll_period_ms = Math.max(_MIN_POLL_PERIOD_MS, _poll_period_ms);

                            // _header_icon_robot.setAttribute("title",
                            //     `Polling time: ${_poll_period_ms} ms\n` + `Round trip time: ${round_trip_time} ms\n`);
                        }

                        // ignore outdated data
                        if (request_time < _last_update) {
                            return;
                        }
                        _last_update = request_time;

                        // ignore empty response and errors
                        if (data === null) {
                            return;
                        }

                        if (data.info !== undefined && data.info !== null) {
                            processInfo(data.info);
                        }
                        if (data.model !== undefined && data.model !== null) {
                            let substatus = null;
                            if (data.velocity_command !== undefined && data.velocity_command !== null) {
                                // TODO: hacky, data.velocity_command[3..6] values are sub-status
                                // 1 for ackermann, 2 for crab
                                // lol
                                if (data.velocity_command[3] === 1) {
                                    substatus = "ackermann";
                                }
                                else if (data.velocity_command[3] === 2) {
                                    substatus = "crab";
                                }
                            }
                            updateSupervisorStatus(data.model["control-stack-supervisor.fsm.current_state"],
                                substatus);

                        }
                        if (data.safety !== undefined && data.safety !== null) {
                            processSafety(data.safety);
                        }
                        if (data.wheels !== undefined && data.wheels !== null) {
                            process_wheels(data.wheels);
                        }
                        if (data.velocity_command !== undefined && data.velocity_command !== null) {
                            process_velocity_command(data.velocity_command);
                        }
                        if (data.log !== undefined && data.log !== null) {
                            process_log(data.log);
                        }
                        if (data.move_base_status !== undefined && data.move_base_status !== null) {
                            process_move_base_status(data.move_base_status);
                        }
                        if (data.batteries !== undefined && data.batteries !== null) {
                            processRobotBatteries(data.batteries);
                        }
                        if (data.motor_torque !== undefined && data.motor_torque !== null) {
                            processMotorTorquesByCompass(data.motor_torque);
                        }
                        if (data.rs_camera !== undefined && data.rs_camera !== null) {
                            _stream_handler.updateImage(data.rs_camera);
                        }
                        if (data.gamepad !== undefined && data.gamepad !== null) {
                            // processGamepadFeedback(data.gamepad);
                        }
                    },
                    { query }
                );
            } catch (e) {
                showDisconnectedStatus();
                console.error("Error:", e, "with query:", query);
            }
        };


        let _poll_count = 0;
        const poll = () => {
            ++_poll_count;
            // TODO: CRADO a
            if (host_svg.className === "disabled-fill") {
                try {
                    poll_server({});
                } catch (e) {
                    console.error("Status poll error:", e);
                }
                setTimeout(poll, 1000);
            } else {
                try {
                    poll_server({
                        model: true,
                        safety: true,
                        wheels: true,
                        velocity_command: true,
                        move_base_status: true,
                        batteries: true,
                        motor_torque: true,
                        rs_camera: _camera_json,
                        gamepad: _gamepad_json,
                        log: _poll_count % 10 == 0,
                    });
                } catch (e) {
                    console.error("Data poll error:", e);
                }

                // TODO(Maximilian, 2022-11-10): Include in data model
                // only send new controlled q when we have something new and no transmission is ongoing
                // DEL OHU
                // let sending_controlled_q = false;
                // if (!sending_controlled_q && !(controlled_q.every((v, i) => v === last_controlled_q[i]))) {
                //     sending_controlled_q = true;
                //     let used_controlled_q = [...controlled_q];
                //     call("write/controlled_q", (data) => {
                //         sending_controlled_q = false;
                //         last_controlled_q = used_controlled_q;
                //     },
                //         { controlled_q: controlled_q });
                // }

                // TODO(Maximilian, 2022-11-10): Include in data model
                // only send new controlled ee when we have something new and no transmission is ongoing
                // DEL OHU
                // let sending_controlled_ee_positions = false;
                // if (!sending_controlled_ee_positions && JSON.stringify(controlled_ee_positions) != JSON.stringify(last_controlled_ee_positions)) {
                //     sending_controlled_ee_positions = true;
                //     let used_ee_positions = JSON.parse(JSON.stringify(controlled_ee_positions));
                //     call("write/controlled_ee_positions", (data) => {
                //         sending_controlled_ee_positions = false;
                //         last_controlled_ee_positions = JSON.parse(JSON.stringify(used_ee_positions));
                //         update_ee_control_status(data);
                //     },
                //         { controlled_ee_positions: controlled_ee_positions });
                // }

                // update modified elements of data model to server
                // DEL OHU
                // if (!data_model.update_in_progress()) {
                //     const data_to_transmit = {};
                //     for (const [id, model_entry] of Object.entries(data_model.data)) {
                //         if (model_entry.needs_write_to_server()) {
                //             model_entry.start_update();
                //             data_to_transmit[id] = {
                //                 slot: model_entry.properties.slot,
                //                 type: model_entry.properties.type,
                //                 value: model_entry.properties.value,
                //             };
                //         }
                //     }
                //     if (Object.keys(data_to_transmit).length > 0) {
                //         data_model.start_update();
                //         let ids = Object.keys(data_to_transmit);
                //         call(
                //             "write/model",
                //             (data) => { data_model.finish_update(ids); },
                //             data_to_transmit
                //         );
                //     }
                // }

                setTimeout(poll, _poll_period_ms);
            }
        };

        // DEL OHU
        // document.getElementById("log-clear").addEventListener("click", (e) => {
        //     log.innerText = "";
        // });

        // DEL OHU
        // for (let element of Array.from(document.querySelectorAll(".operating-state"))) {
        //     element.addEventListener("click", (e) => {
        //         const old_id = document
        //             .querySelector(".operating-state-active")
        //             ?.getAttribute("data-id");
        //         const new_id = e.target.getAttribute("data-id");
        //         if (old_id !== undefined) {
        //             e.target.classList.add("operating-state-loading");
        //             call("write/hal.safety", (data) => { }, {
        //                 old_operating_state_id: old_id,
        //                 new_operating_state_id: new_id,
        //             });
        //         }
        //     });
        // }

        // DEL OHU
        // open_tab('motor-status');
        // document.getElementById("q-control-reload").addEventListener("click", (e) => { setup_q_control() });
        // document.getElementById("ee-control-reload").addEventListener("click", (e) => { setup_ee_control() });

        // DEL OHU
        // setup_control_stack();

        poll();


    </script>

</body>

</html>

<!----------------------------------------------------------------------------->
<!----------------------------------------------------------------------------->
<!-- SVG SYMBOLS -------------------------------------------------------------->
<!----------------------------------------------------------------------------->
<!----------------------------------------------------------------------------->
<svg display="none">
    <!-- LOGO -->
    <symbol xmlns="http://www.w3.org/2000/svg" width="108.852" height="44" viewBox="0 0 108.852 44">
        <g id="logo" transform="translate(-144.785 -134.991)">
            <path id="Trac_59" data-name="Trac 59"
                d="M226.44,198.746v8.106a5.991,5.991,0,0,0,5.991,5.993h0a5.993,5.993,0,0,0,5.993-5.993V181.08Z"
                transform="translate(-60.46 -34.126)" fill="#eee" />
            <path id="Trac_60" data-name="Trac 60"
                d="M327.213,178.517,317.09,162.7a12.323,12.323,0,0,0,3.481-2.855,13.806,13.806,0,0,0,2.6-4.849,18.431,18.431,0,0,0,.8-5.321,15.573,15.573,0,0,0-1.124-6.058,12.594,12.594,0,0,0-3.281-4.612,14.8,14.8,0,0,0-5.352-2.977,23.621,23.621,0,0,0-7.268-1.038H293.75v43.524h8.566V164.682h5.71l9.191,13.835Zm-24.89-35.236h6.149a7.075,7.075,0,0,1,3.577.779,5.3,5.3,0,0,1,1.98,1.892,7.2,7.2,0,0,1,.857,2.217,10.156,10.156,0,0,1,.208,1.8,7.148,7.148,0,0,1-.327,2.04,6.749,6.749,0,0,1-1.064,2.1,5.55,5.55,0,0,1-2.038,1.656,7.216,7.216,0,0,1-3.252.651h-6.089Z"
                transform="translate(-110.299 0)" fill="#eee" />
            <path id="Trac_61" data-name="Trac 61"
                d="M436.981,162.481a7.125,7.125,0,0,0,1.241,3.964,9.623,9.623,0,0,0,3.283,3.073,8.722,8.722,0,0,0,4.462,1.184,9.333,9.333,0,0,0,8.01-4.257,7.236,7.236,0,0,0,1.212-3.961V135.05h8.454v27.607a15.4,15.4,0,0,1-2.365,8.485,16.469,16.469,0,0,1-6.385,5.793,18.989,18.989,0,0,1-8.926,2.1,18.689,18.689,0,0,1-8.838-2.1,16.526,16.526,0,0,1-6.354-5.793,15.373,15.373,0,0,1-2.365-8.485V135.05h8.566Z"
                transform="translate(-210.006 -0.044)" fill="#eee" />
            <path id="Trac_62" data-name="Trac 62"
                d="M171.989,136.85h0a5.97,5.97,0,0,0-4.932,2.616l-21.248,31.316a5.97,5.97,0,0,0,4.932,9.313h0a5.97,5.97,0,0,0,4.932-2.616l21.245-31.316a5.97,5.97,0,0,0-4.929-9.313Zm-.018,9.879a3.893,3.893,0,1,1,3.893-3.893,3.893,3.893,0,0,1-3.893,3.893Z"
                transform="translate(0 -1.377)" fill="#3db6d6" />
        </g>
    </symbol>

    <!-- BATTERY BOT -->
    <symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40.8" height="31.2">
        <defs>
            <clipPath id="clip-path">
                <rect id="Rectangle_2219" data-name="Rectangle 2219" width="40.8" height="31.2" />
            </clipPath>
        </defs>
        <g id="svg-icon-robot-battery" data-name="battery robot" transform="translate(0 12)">
            <g id="Groupe_3340" data-name="Groupe 3340" clip-path="url(#clip-path)">
                <path id="Trac_90" data-name="Trac 90"
                    d="M7.788,18.945A1.455,1.455,0,0,0,6.333,20.4v.007a1.455,1.455,0,1,0,1.455-1.462" />
                <path id="Trac_91" data-name="Trac 91"
                    d="M13.607,18.945A1.455,1.455,0,0,0,12.152,20.4v.007a1.455,1.455,0,1,0,1.455-1.462" />
                <path id="Trac_92" data-name="Trac 92"
                    d="M39.8,8.27a1.993,1.993,0,0,0-1-.26L36,8V6a6,6,0,0,0-6-6H8.4a6,6,0,0,0-6,6v4.22A13.2,13.2,0,0,1,24,20.4a12.925,12.925,0,0,1-.5,3.6H30a6,6,0,0,0,6-6V16l2.8.01a2,2,0,0,0,2-2v-4a2.014,2.014,0,0,0-1-1.74" />
                <path id="Trac_93" data-name="Trac 93"
                    d="M10.8,9.6A10.8,10.8,0,1,0,21.6,20.4,10.8,10.8,0,0,0,10.8,9.6m7.172,13.71a2.182,2.182,0,0,1-2.182,2.182H5.606A2.182,2.182,0,0,1,3.423,23.31V17.491a2.183,2.183,0,0,1,2.183-2.183H9.97v-.727a.735.735,0,0,1,.728-.728h.055a.7.7,0,0,1,.672.728v.727H15.79a2.182,2.182,0,0,1,2.182,2.183Z" />
            </g>
        </g>
    </symbol>

    <!-- BATTERY PAD -->
    <symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40.8" height="31.2"
        viewBox="0 0 40.8 31.2">
        <defs>
            <clipPath id="clip-path">
                <rect id="Rectangle_2220" data-name="Rectangle 2220" width="40.8" height="31.2"
                    transform="translate(0 0)" fill="#eee" />
            </clipPath>
        </defs>
        <g id="svg-icon-host-battery" data-name="battery host" transform="translate(0 12)">
            <g id="Groupe_3342" data-name="Groupe 3342" clip-path="url(#clip-path)">
                <path id="Trac_94" data-name="Trac 94"
                    d="M39.8,8.27a1.993,1.993,0,0,0-1-.26L36,8V6a6,6,0,0,0-6-6H8.4a6,6,0,0,0-6,6v4.22A13.2,13.2,0,0,1,24,20.4a12.925,12.925,0,0,1-.5,3.6H30a6,6,0,0,0,6-6V16l2.8.01a2,2,0,0,0,2-2v-4a2.014,2.014,0,0,0-1-1.74" />
                <path id="Trac_95" data-name="Trac 95"
                    d="M10.8,9.6A10.8,10.8,0,1,0,21.6,20.4,10.8,10.8,0,0,0,10.8,9.6m7.825,15.988a1.468,1.468,0,0,1-1.186.508,1.822,1.822,0,0,1-.777-.149,1.886,1.886,0,0,1-.537-.368l-2.072-2.071h-6.5L5.487,25.579a1.905,1.905,0,0,1-.538.368,1.825,1.825,0,0,1-.778.151,1.466,1.466,0,0,1-1.185-.508,1.738,1.738,0,0,1-.309-1.4l.956-6.675A3.01,3.01,0,0,1,4.619,15.7,2.716,2.716,0,0,1,6.5,14.94h8.627a2.714,2.714,0,0,1,1.883.757A3.013,3.013,0,0,1,18,17.51l.936,6.675a1.741,1.741,0,0,1-.309,1.4" />
            </g>
        </g>
    </symbol>

    <!-- BOT -->
    <symbol id="svg-icon-robot" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
        <path id="Trac_53" data-name="Trac 53"
            d="M35.26,27.61a4.336,4.336,0,0,1,4.34,4.34V33.6h-.01a8.457,8.457,0,0,1-2.7,6.14C34.6,41.83,30.64,43.2,24,43.2s-10.6-1.37-12.89-3.46a8.457,8.457,0,0,1-2.7-6.14H8.4V31.95a4.336,4.336,0,0,1,4.34-4.34ZM15.6,7.2A3.6,3.6,0,0,0,12,10.8v9.6A3.6,3.6,0,0,0,15.6,24H32.4A3.6,3.6,0,0,0,36,20.4V10.8a3.6,3.6,0,0,0-3.6-3.6H25.2V6A1.155,1.155,0,0,0,24,4.8,1.21,1.21,0,0,0,22.8,6V7.2Zm1.2,8.4A2.4,2.4,0,1,1,19.2,18,2.394,2.394,0,0,1,16.8,15.6Zm9.6,0A2.4,2.4,0,1,1,28.8,18,2.394,2.394,0,0,1,26.4,15.6Z" />
    </symbol>

    <!-- LAPTOP -->
    <symbol id="svg-icon-laptop" data-name="Calque 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
        <defs>
            <style>
                .cls-2 {
                    fill: none;
                }
            </style>
        </defs>
        <path id="Trac_97" data-name="Trac 97" class="cls-1"
            d="m9,16.5c0-2.48,2.01-4.5,4.49-4.5,0,0,0,0,.01,0h21c2.48,0,4.5,2.01,4.5,4.49,0,0,0,0,0,.01v12c0,2.48-2.01,4.5-4.49,4.5,0,0,0,0-.01,0H13.5c-2.48,0-4.5-2.01-4.5-4.49,0,0,0,0,0-.01v-12Zm-1.5,19.5c-.83,0-1.5.67-1.5,1.5s.67,1.5,1.5,1.5h33c.83,0,1.5-.67,1.5-1.5s-.67-1.5-1.5-1.5H7.5Z" />
        <path id="Trac_98" data-name="Trac 98" class="cls-2" d="m0,0h48v48H0V0Z" />
    </symbol>

    <!-- CELLULAR DATA -->
    <symbol id="svg-icon-wifi" data-name="Cellular Data 1" xmlns="http://www.w3.org/2000/svg" width="48" height="48"
        viewBox="0 0 48 48">
        <path id="Trac_11" data-name="Trac 11"
            d="M11.4,28.8a1.808,1.808,0,0,1,1.78,1.53l.02.27v6a1.8,1.8,0,0,1-3.58.27L9.6,36.6v-6A1.805,1.805,0,0,1,11.4,28.8ZM18.6,24a1.808,1.808,0,0,1,1.78,1.53l.02.27V36.6a1.8,1.8,0,0,1-3.58.27l-.02-.27V25.8A1.805,1.805,0,0,1,18.6,24Zm7.2-4.8a1.808,1.808,0,0,1,1.78,1.53l.02.27V36.6a1.8,1.8,0,0,1-3.58.27L24,36.6V21A1.805,1.805,0,0,1,25.8,19.2ZM33,14.4a1.808,1.808,0,0,1,1.78,1.53l.02.27V36.6a1.8,1.8,0,0,1-3.58.26l-.02-.26V16.2A1.805,1.805,0,0,1,33,14.4Zm7.2-4.8a1.788,1.788,0,0,1,1.78,1.5l.02.26L41.97,36.6a1.787,1.787,0,0,1-3.55.3l-.02-.26.03-25.24A1.793,1.793,0,0,1,40.2,9.6Z" />
        <path id="Trac_12" data-name="Trac 12" d="M0,0H48V48H0Z" fill="none" />
    </symbol>

    <!-- LIGHTNING ICON -->
    <symbol id="flash" xmlns="http://www.w3.org/2000/svg" width="20.964" height="20.964" viewBox="0 0 20.964 20.964">
        <path id="Trac_23" data-name="Trac 23"
            d="M12.762,3a1.312,1.312,0,0,0-1.258.935L9.036,12.22a.982.982,0,0,0,.943,1.262h2.075l-1.677,5.752a1.636,1.636,0,0,0,2.852,1.476L21.885,9.835a.981.981,0,0,0-.769-1.594h-2.66l1.3-3.472A1.307,1.307,0,0,0,18.535,3Z"
            transform="translate(-5.066 -1.69)" />
        <path id="Trac_24" data-name="Trac 24" d="M0,0H20.964V20.964H0Z" fill="none" />
    </symbol>

    <!-- GAUGE -->
    <symbol id="gauge" xmlns="http://www.w3.org/2000/svg" width="27.974" height="27.974" viewBox="0 0 27.974 27.974">
        <path id="Trac_25" data-name="Trac 25"
            d="M15.99,27.179A11.19,11.19,0,1,0,4.8,15.99,11.193,11.193,0,0,0,15.99,27.179ZM18.531,9.474a6.995,6.995,0,0,0-7.489,11.464.7.7,0,1,1-.985.985A8.394,8.394,0,0,1,19.043,8.169a.7.7,0,0,1-.513,1.305Zm5.28,3.462a8.4,8.4,0,0,1-1.888,8.987.7.7,0,0,1-.985-.985,7,7,0,0,0,1.568-7.489.7.7,0,1,1,1.305-.513ZM21.7,10.144a.7.7,0,0,1,.157.874l-.157.274c-.093.175-.239.425-.408.728-.163.28-.35.606-.548.956l-.321.565-.42.723c-.192.338-.4.682-.589,1.02-.28.478-.554.938-.793,1.346-.2.338-.39.641-.542.874-.047.082-.1.157-.146.233-.035.052-.07.1-.1.152-.047.064-.087.122-.122.163a2.1,2.1,0,0,1-3.194-2.727,5.449,5.449,0,0,1,.478-.455c.216-.186.484-.414.787-.67.606-.513,1.37-1.136,2.116-1.737s1.474-1.189,2.016-1.62l.385-.309.519-.408A.687.687,0,0,1,21.7,10.144Z"
            transform="translate(-2.003 -2.003)" />
        <path id="Trac_26" data-name="Trac 26" d="M0,0H27.974V27.974H0Z" fill="none" />
    </symbol>

    <!-- INFO TOOLTIP -->
    <symbol id="info" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path id="Trac_47" data-name="Trac 47"
            d="M20,12a8,8,0,1,1-8-8A8,8,0,0,1,20,12Zm-8.8.8v2.4a.8.8,0,0,0,1.6,0V12.8a.8.8,0,1,0-1.6,0ZM12,8.4a1.2,1.2,0,1,0,1.2,1.2A1.2,1.2,0,0,0,12,8.4Z" />
        <path id="Trac_48" data-name="Trac 48" d="M0,0H24V24H0Z" fill="none" />
    </symbol>

    <!-- CAMERA ICON -->
    <symbol id="svg-icon-camera" data-name="Meet Now" xmlns="http://www.w3.org/2000/svg" width="48" height="48"
        viewBox="0 0 48 48">
        <path id="Trac_33" data-name="Trac 33"
            d="M14.3,8.77l.01-.01.03-.01a.6.6,0,0,1,.13-.08c.12-.08.31-.18.56-.31a20.7,20.7,0,0,1,2.1-.96A19.04,19.04,0,0,1,24,6a19.04,19.04,0,0,1,6.87,1.4,20.7,20.7,0,0,1,2.1.96c.25.13.44.23.56.31a.6.6,0,0,1,.13.08l.03.01.01.01a1.5,1.5,0,1,0,1.6-2.54h0l-.02-.01-.05-.03c-.05-.03-.11-.07-.19-.11-.16-.1-.38-.22-.67-.38a24.761,24.761,0,0,0-2.4-1.1A22.16,22.16,0,0,0,24,3a22.16,22.16,0,0,0-7.97,1.6,24.761,24.761,0,0,0-2.4,1.1c-.29.16-.51.28-.67.38-.08.04-.14.08-.19.11l-.05.03-.02.01h0a1.5,1.5,0,1,0,1.6,2.54ZM12,12a6,6,0,0,0-6,6V30a6,6,0,0,0,6,6H24a6,6,0,0,0,6-6V18a6,6,0,0,0-6-6Zm30,4.5a1.5,1.5,0,0,0-2.4-1.2l-6,4.5A1.492,1.492,0,0,0,33,21v6a1.492,1.492,0,0,0,.6,1.2l6,4.5A1.5,1.5,0,0,0,42,31.5ZM14.31,39.24l-.01-.01a1.5,1.5,0,0,0-1.6,2.54h0l.02.01.05.03c.05.03.11.07.19.11.16.1.38.22.67.38a24.761,24.761,0,0,0,2.4,1.1A22.16,22.16,0,0,0,24,45a22.16,22.16,0,0,0,7.97-1.6,24.761,24.761,0,0,0,2.4-1.1c.29-.16.51-.28.67-.38.08-.04.14-.08.19-.11l.05-.03.02-.01h0a1.5,1.5,0,1,0-1.6-2.54l-.01.01-.03.01a.6.6,0,0,1-.13.08c-.12.08-.31.18-.56.31a20.7,20.7,0,0,1-2.1.96A19.04,19.04,0,0,1,24,42a19.04,19.04,0,0,1-6.87-1.4,20.7,20.7,0,0,1-2.1-.96c-.25-.13-.44-.23-.56-.31a.6.6,0,0,1-.13-.08Z" />
        <path id="Trac_34" data-name="Trac 34" d="M0,0H48V48H0Z" fill="none" />
    </symbol>

    <!-- PAD -->
    <symbol xmlns="http://www.w3.org/2000/svg" width="48.825" height="33.4" viewBox="0 0 48.825 33.4">
        <g id="svg-icon-gamepad">
            <path id="sports_esports_FILL0_wght400_GRAD0_opsz48"
                d="M75.242-726.6a4.391,4.391,0,0,1-3.549-1.521,5.2,5.2,0,0,1-.924-4.2l2.863-19.98a9.016,9.016,0,0,1,2.952-5.428A8.116,8.116,0,0,1,82.22-760h25.825a8.116,8.116,0,0,1,5.636,2.266,9.016,9.016,0,0,1,2.952,5.428l2.8,19.98a5.2,5.2,0,0,1-.924,4.2,4.391,4.391,0,0,1-3.549,1.521,5.454,5.454,0,0,1-2.326-.447,5.628,5.628,0,0,1-1.61-1.1l-6.2-6.2H85.381l-6.2,6.2a5.628,5.628,0,0,1-1.61,1.1A5.454,5.454,0,0,1,75.242-726.6Zm1.074-3.817,7.515-7.515h22.545l7.515,7.515a2.662,2.662,0,0,0,1.074.537.86.86,0,0,0,.805-.537,1.577,1.577,0,0,0,.149-1.074l-2.863-20.219a5.445,5.445,0,0,0-1.759-3.4,4.751,4.751,0,0,0-3.251-1.312H82.161a4.751,4.751,0,0,0-3.251,1.312,5.445,5.445,0,0,0-1.759,3.4l-2.863,20.219a1.577,1.577,0,0,0,.149,1.074.86.86,0,0,0,.805.537A1.911,1.911,0,0,0,76.316-730.417Zm31.909-10.5a2.289,2.289,0,0,0,1.67-.716,2.289,2.289,0,0,0,.716-1.67,2.289,2.289,0,0,0-.716-1.67,2.289,2.289,0,0,0-1.67-.716,2.289,2.289,0,0,0-1.67.716,2.289,2.289,0,0,0-.716,1.67,2.289,2.289,0,0,0,.716,1.67A2.289,2.289,0,0,0,108.225-740.914Zm-5.07-7.754a2.289,2.289,0,0,0,1.67-.716,2.289,2.289,0,0,0,.716-1.67,2.289,2.289,0,0,0-.716-1.67,2.289,2.289,0,0,0-1.67-.716,2.289,2.289,0,0,0-1.67.716,2.289,2.289,0,0,0-.716,1.67,2.289,2.289,0,0,0,.716,1.67A2.289,2.289,0,0,0,103.155-748.668Zm-18.788,7.455H87.35v-4.473h4.473v-2.982H87.35v-4.473H84.368v4.473H79.894v2.982h4.473ZM95.1-743.181Z"
                transform="translate(-71.103 769.8)" />
        </g>
    </symbol>

    <!-- WARNING -->
    <symbol id="warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path id="Trac_39" data-name="Trac 39"
            d="M12.426,4.915a1.813,1.813,0,0,1,3.15,0l8.18,14.34A1.831,1.831,0,0,1,22.186,22H5.816a1.831,1.831,0,0,1-1.57-2.745ZM13,11v2a1,1,0,0,0,2,0V11a1,1,0,0,0-2,0Zm1,4.5A1.5,1.5,0,1,0,15.5,17,1.5,1.5,0,0,0,14,15.5Z"
            transform="translate(-2.001 -2)" />
        <path id="Trac_40" data-name="Trac 40" d="M0,0H24V24H0Z" fill="none" />
    </symbol>

    <!-- SNOW FLAKE -->
    <symbol id="weatherSnowflake" data-name="Weather Snowflake" xmlns="http://www.w3.org/2000/svg" width="24"
        height="24" viewBox="0 0 24 24">
        <path id="Trac_41" data-name="Trac 41"
            d="M12,4.8a.675.675,0,0,1,.667.585l.008.09V7.612L14.032,6.42a.674.674,0,1,1,.889,1.013L12.675,9.409v1.916h1.916l1.976-2.246a.675.675,0,0,1,.874-.124l.079.06a.674.674,0,0,1,.12.874l-.06.079-1.189,1.358h2.134a.672.672,0,0,1,.667.581L19.2,12a.675.675,0,0,1-.585.667l-.09.008H16.388l1.192,1.357a.672.672,0,0,1,.008.881l-.068.071a.677.677,0,0,1-.881.007l-.071-.071-1.976-2.246H12.675v1.916l2.246,1.976a.678.678,0,0,1,.124.874l-.06.079a.674.674,0,0,1-.874.12l-.079-.06-1.357-1.192,0,2.137a.672.672,0,0,1-.581.667L12,19.2a.675.675,0,0,1-.667-.585l-.007-.09V16.388L9.967,17.58a.674.674,0,1,1-.889-1.012l2.246-1.976V12.675H9.566L7.432,15.1a.674.674,0,1,1-1.013-.889l1.35-1.537h-2.3a.675.675,0,0,1-.668-.585L4.8,12a.672.672,0,0,1,.585-.667l.09-.007H7.451L6.42,10.148a.674.674,0,1,1,1.013-.889l1.815,2.066h2.077V9.4L9.079,7.432a.679.679,0,0,1-.124-.874l.06-.079a.679.679,0,0,1,.874-.124l.079.06,1.358,1.192V5.475a.677.677,0,0,1,.495-.653l.09-.015Z"
            transform="translate(0 0)" />
        <path id="Trac_42" data-name="Trac 42" d="M0,0H24V24H0Z" fill="none" />
    </symbol>

    <!-- CODE TAG -->
    <symbol id="code" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path id="Trac_57" data-name="Trac 57"
            d="M16.73,8.344a1.129,1.129,0,0,1,.575,1.485l-6,13.5a1.126,1.126,0,1,1-2.06-.91l6-13.5A1.129,1.129,0,0,1,16.73,8.344ZM8.62,11.909a1.124,1.124,0,0,1,.1,1.59L6.38,16.124l2.335,2.63a1.124,1.124,0,0,1-1.68,1.5l-3-3.375a1.123,1.123,0,0,1,0-1.495l3-3.375A1.119,1.119,0,0,1,8.62,11.909Zm10.51,0a1.119,1.119,0,0,1,1.585.1l3,3.375a1.123,1.123,0,0,1,0,1.495l-3,3.375a1.124,1.124,0,0,1-1.68-1.5l2.335-2.63L19.035,13.5A1.124,1.124,0,0,1,19.13,11.909Z"
            transform="translate(-1.875 -4.124)" fill="#eee" />
        <path id="Trac_58" data-name="Trac 58" d="M0,0H24V24H0Z" fill="none" />
    </symbol>
</svg>
